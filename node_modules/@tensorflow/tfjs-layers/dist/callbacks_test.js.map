{"version":3,"file":"callbacks_test.js","sourceRoot":"","sources":["../src/callbacks_test.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2018 Google LLC\n *\n * Use of this source code is governed by an MIT-style\n * license that can be found in the LICENSE file or at\n * https://opensource.org/licenses/MIT.\n * =============================================================================\n */\n\nimport {tensor2d} from '@tensorflow/tfjs-core';\n\nimport * as tfl from './index';\nimport {describeMathCPUAndGPU} from './utils/test_utils';\n\ndescribe('EarlyStopping', () => {\n  function createDummyModel(): tfl.LayersModel {\n    const model = tfl.sequential();\n    model.add(tfl.layers.dense({units: 1, inputShape: [1]}));\n    model.compile({loss: 'meanSquaredError', optimizer: 'sgd'});\n    return model;\n  }\n\n  it('Default monitor, default mode, increasing val_loss', async () => {\n    const model = createDummyModel();\n    const callback = tfl.callbacks.earlyStopping();\n    callback.setModel(model);\n\n    await callback.onTrainBegin();\n    await callback.onEpochBegin(0);\n    await callback.onEpochEnd(0, {val_loss: 10});\n    expect(model.stopTraining).toBeUndefined();\n    await callback.onEpochBegin(1);\n    await callback.onEpochEnd(1, {val_loss: 9});\n    expect(model.stopTraining).toBeUndefined();\n    await callback.onEpochBegin(2);\n    await callback.onEpochEnd(2, {val_loss: 9.5});\n    expect(model.stopTraining).toEqual(true);\n  });\n\n  it('Default monitor, default mode, holding val_loss', async () => {\n    const model = createDummyModel();\n    const callback = tfl.callbacks.earlyStopping();\n    callback.setModel(model);\n\n    await callback.onTrainBegin();\n    await callback.onEpochBegin(0);\n    await callback.onEpochEnd(0, {val_loss: 10});\n    expect(model.stopTraining).toBeUndefined();\n    await callback.onEpochBegin(1);\n    await callback.onEpochEnd(1, {val_loss: 9});\n    expect(model.stopTraining).toBeUndefined();\n    await callback.onEpochBegin(2);\n    await callback.onEpochEnd(2, {val_loss: 9});\n    expect(model.stopTraining).toEqual(true);\n  });\n\n  it('Default monitor, default mode, custom minDelta', async () => {\n    const model = createDummyModel();\n    const callback = tfl.callbacks.earlyStopping({minDelta: 1});\n    callback.setModel(model);\n\n    await callback.onTrainBegin();\n    await callback.onEpochBegin(0);\n    await callback.onEpochEnd(0, {val_loss: 10});\n    expect(model.stopTraining).toBeUndefined();\n    await callback.onEpochBegin(1);\n    await callback.onEpochEnd(1, {val_loss: 8});\n    expect(model.stopTraining).toBeUndefined();\n    await callback.onEpochBegin(2);\n    // An decrease of 0.5 is < minDelta (1) and should trigger stop.\n    await callback.onEpochEnd(2, {val_loss: 7.5});\n    expect(model.stopTraining).toEqual(true);\n  });\n\n  it('Default monitor, default mode, custom baseline, stopping', async () => {\n    const model = createDummyModel();\n    const callback = tfl.callbacks.earlyStopping({baseline: 5});\n    callback.setModel(model);\n\n    await callback.onTrainBegin();\n    await callback.onEpochBegin(1);\n    // Failure to go below the baseline will stop the training immediately.\n    await callback.onEpochEnd(1, {val_loss: 6});\n    expect(model.stopTraining).toEqual(true);\n  });\n\n  it('Default monitor, default mode, custom baseline, not stopping',\n     async () => {\n       const model = createDummyModel();\n       const callback = tfl.callbacks.earlyStopping({baseline: 5});\n       callback.setModel(model);\n\n       await callback.onTrainBegin();\n       await callback.onEpochBegin(1);\n       // If the loss value goes below the baseline, training should continue.\n       await callback.onEpochEnd(1, {val_loss: 4});\n       expect(model.stopTraining).toBeUndefined();\n       // If the loss value increases, training should stop;\n       await callback.onEpochEnd(1, {val_loss: 4.5});\n       expect(model.stopTraining).toEqual(true);\n     });\n\n  it('Custom monitor, default model, increasing', async () => {\n    const model = createDummyModel();\n    const callback = tfl.callbacks.earlyStopping({monitor: 'aux_loss'});\n    callback.setModel(model);\n\n    await callback.onTrainBegin();\n    await callback.onEpochBegin(0);\n    await callback.onEpochEnd(0, {val_loss: 10, aux_loss: 100});\n    expect(model.stopTraining).toBeUndefined();\n    await callback.onEpochBegin(1);\n    await callback.onEpochEnd(1, {val_loss: 9, aux_loss: 120});\n    expect(model.stopTraining).toEqual(true);\n  });\n\n  it('Custom monitor, max, increasing', async () => {\n    const model = createDummyModel();\n    const callback =\n        tfl.callbacks.earlyStopping({monitor: 'aux_metric', mode: 'max'});\n    callback.setModel(model);\n\n    await callback.onTrainBegin();\n    await callback.onEpochBegin(0);\n    await callback.onEpochEnd(0, {val_loss: 10, aux_metric: 100});\n    expect(model.stopTraining).toBeUndefined();\n    await callback.onEpochBegin(1);\n    await callback.onEpochEnd(1, {val_loss: 9, aux_metric: 120});\n    expect(model.stopTraining).toBeUndefined();\n    await callback.onEpochBegin(2);\n    await callback.onEpochEnd(2, {val_loss: 9, aux_metric: 110});\n    expect(model.stopTraining).toEqual(true);\n  });\n\n  it('Custom monitor, max, custom minDelta', async () => {\n    const model = createDummyModel();\n    const callback = tfl.callbacks.earlyStopping(\n        {monitor: 'aux_metric', mode: 'max', minDelta: 5});\n    callback.setModel(model);\n\n    await callback.onTrainBegin();\n    await callback.onEpochBegin(0);\n    await callback.onEpochEnd(0, {val_loss: 10, aux_metric: 100});\n    expect(model.stopTraining).toBeUndefined();\n    await callback.onEpochBegin(1);\n    await callback.onEpochEnd(1, {val_loss: 9, aux_metric: 120});\n    expect(model.stopTraining).toBeUndefined();\n    await callback.onEpochBegin(2);\n    // An increase of 2 is < minDelta (5) and should cause stopping.\n    await callback.onEpochEnd(2, {val_loss: 9, aux_metric: 122});\n    expect(model.stopTraining).toEqual(true);\n  });\n\n  it('Custom monitor, max, custom negative minDelta', async () => {\n    const model = createDummyModel();\n    const callback = tfl.callbacks.earlyStopping(\n        {monitor: 'aux_metric', mode: 'max', minDelta: -5});\n    callback.setModel(model);\n\n    await callback.onTrainBegin();\n    await callback.onEpochBegin(0);\n    await callback.onEpochEnd(0, {val_loss: 10, aux_metric: 100});\n    expect(model.stopTraining).toBeUndefined();\n    await callback.onEpochBegin(1);\n    await callback.onEpochEnd(1, {val_loss: 9, aux_metric: 120});\n    expect(model.stopTraining).toBeUndefined();\n    await callback.onEpochBegin(2);\n    // An increase of 2 is < minDelta (5) and should cause stopping.\n    await callback.onEpochEnd(2, {val_loss: 9, aux_metric: 122});\n    expect(model.stopTraining).toEqual(true);\n  });\n\n  it('Patience = 2', async () => {\n    const model = createDummyModel();\n    const callback = tfl.callbacks.earlyStopping({patience: 2});\n    callback.setModel(model);\n\n    await callback.onTrainBegin();\n    await callback.onEpochBegin(0);\n    await callback.onEpochEnd(0, {val_loss: 10});\n    expect(model.stopTraining).toBeUndefined();\n    await callback.onEpochBegin(1);\n    await callback.onEpochEnd(1, {val_loss: 9});\n    expect(model.stopTraining).toBeUndefined();\n    await callback.onEpochBegin(2);\n    await callback.onEpochEnd(2, {val_loss: 9.5});\n    expect(model.stopTraining).toBeUndefined();\n    await callback.onEpochBegin(3);\n    await callback.onEpochEnd(3, {val_loss: 9.6});\n    expect(model.stopTraining).toEqual(true);\n  });\n\n  it('Missing monitor leads to warning', async () => {\n    const model = createDummyModel();\n    const callback = tfl.callbacks.earlyStopping();\n    callback.setModel(model);\n\n    const warnMessages: string[] = [];\n    function fakeWarn(message: string) {\n      warnMessages.push(message);\n    }\n    spyOn(console, 'warn').and.callFake(fakeWarn);\n\n    await callback.onTrainBegin();\n    await callback.onEpochBegin(0);\n    // Note that the default monitor (val_loss) is missing.\n    await callback.onEpochEnd(0, {loss: 100});\n    expect(model.stopTraining).toBeUndefined();\n    await callback.onEpochBegin(1);\n    await callback.onEpochEnd(1, {loss: 100});\n    expect(model.stopTraining).toBeUndefined();\n\n    expect(warnMessages.length).toEqual(2);\n    expect(warnMessages[0]).toMatch(/val_loss is not available/);\n    expect(warnMessages[1]).toMatch(/val_loss is not available/);\n  });\n});\n\ndescribeMathCPUAndGPU('EarlyStopping LayersModel.fit() integration', () => {\n  it('Functional model, monitor loss, With minDelta', async () => {\n    const input = tfl.input({shape: [1]});\n    const output =\n        tfl.layers.dense({units: 1, kernelInitializer: 'ones'}).apply(input) as\n        tfl.SymbolicTensor;\n    const model = tfl.model({inputs: input, outputs: output});\n    const xs = tensor2d([1, 2, 3, 4], [4, 1]);\n    const ys = tensor2d([2, 3, 4, 5], [4, 1]);\n    model.compile({loss: 'meanSquaredError', optimizer: 'sgd'});\n\n    // Without the EarlyStopping callback, the loss value would be:\n    //   1, 0.734, 0.549, 0.421, 0.332, ...\n    // With loss being monitored and minDelta set to 0.25, the training should\n    // stop after the 3rd epoch.\n    const history = await model.fit(xs, ys, {\n      epochs: 10,\n      callbacks: tfl.callbacks.earlyStopping({monitor: 'loss', minDelta: 0.25})\n    });\n    expect(history.history.loss.length).toEqual(3);\n  });\n\n  it('Sequential model, monitor val_acc', async () => {\n    const model = tfl.sequential();\n    model.add(tfl.layers.dense({\n      units: 3,\n      activation: 'softmax',\n      kernelInitializer: 'ones',\n      inputShape: [2]\n    }));\n    const xs = tensor2d([1, 2, 3, 4], [2, 2]);\n    const ys = tensor2d([[1, 0, 0], [0, 1, 0]], [2, 3]);\n    const xsVal = tensor2d([4, 3, 2, 1], [2, 2]);\n    const ysVal = tensor2d([[0, 0, 1], [0, 1, 0]], [2, 3]);\n    model.compile(\n        {loss: 'categoricalCrossentropy', optimizer: 'sgd', metrics: ['acc']});\n\n    // Without the EarlyStopping callback, the val_acc value would be:\n    //   0.5, 0.5, 0.5, 0.5, ...\n    // With val_acc being monitored, training should stop after the 2nd epoch.\n    const history = await model.fit(xs, ys, {\n      epochs: 10,\n      validationData: [xsVal, ysVal],\n      callbacks: tfl.callbacks.earlyStopping({monitor: 'val_acc'})\n    });\n    expect(history.history.loss.length).toEqual(2);\n  });\n\n  it('Sequential model, monitor val_acc, custom patience', async () => {\n    const model = tfl.sequential();\n    model.add(tfl.layers.dense({\n      units: 3,\n      activation: 'softmax',\n      kernelInitializer: 'ones',\n      inputShape: [2]\n    }));\n    const xs = tensor2d([1, 2, 3, 4], [2, 2]);\n    const ys = tensor2d([[1, 0, 0], [0, 1, 0]], [2, 3]);\n    const xsVal = tensor2d([4, 3, 2, 1], [2, 2]);\n    const ysVal = tensor2d([[0, 0, 1], [0, 1, 0]], [2, 3]);\n    model.compile(\n        {loss: 'categoricalCrossentropy', optimizer: 'sgd', metrics: ['acc']});\n\n    // Without the EarlyStopping callback, the val_acc value would be:\n    //   0.5, 0.5, 0.5, 0.5, ...\n    // With val_acc being monitored and patience set to 4, training should stop\n    // after the 5th epoch.\n    const history = await model.fit(xs, ys, {\n      epochs: 10,\n      validationData: [xsVal, ysVal],\n      callbacks: tfl.callbacks.earlyStopping({monitor: 'val_acc', patience: 4})\n    });\n    expect(history.history.loss.length).toEqual(5);\n  });\n});\n"]}