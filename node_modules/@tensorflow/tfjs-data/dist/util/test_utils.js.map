{"version":3,"file":"test_utils.js","sourceRoot":"","sources":["../../src/util/test_utils.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * =============================================================================\n */\n\n// tslint:disable-next-line: no-imports-from-dist\nimport {ALL_ENVS, BROWSER_ENVS, describeWithFlags, NODE_ENVS, registerTestEnv} from '@tensorflow/tfjs-core/dist/jasmine_util';\n\n// Provide fake video stream\nexport function setupFakeVideoStream() {\n  const width = 100;\n  const height = 200;\n  const canvasElement = document.createElement('canvas');\n  const ctx = canvasElement.getContext('2d');\n  ctx.fillStyle = 'rgb(1,2,3)';\n  ctx.fillRect(0, 0, width, height);\n  // tslint:disable-next-line:no-any\n  const stream = (canvasElement as any).captureStream(60);\n  navigator.mediaDevices.getUserMedia = async () => {\n    return stream;\n  };\n}\n\nexport async function replaceHTMLVideoElementSource(\n    videoElement: HTMLVideoElement) {\n  const source = document.createElement('source');\n  // tslint:disable:max-line-length\n  source.src =\n      'data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAu1tZGF0AAACrQYF//+p3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE1NSByMjkwMSA3ZDBmZjIyIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxOCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTMgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MzoweDExMyBtZT1oZXggc3VibWU9NyBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0xIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MSA4eDhkY3Q9MSBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0tMiB0aHJlYWRzPTMgbG9va2FoZWFkX3RocmVhZHM9MSBzbGljZWRfdGhyZWFkcz0wIG5yPTAgZGVjaW1hdGU9MSBpbnRlcmxhY2VkPTAgYmx1cmF5X2NvbXBhdD0wIGNvbnN0cmFpbmVkX2ludHJhPTAgYmZyYW1lcz0zIGJfcHlyYW1pZD0yIGJfYWRhcHQ9MSBiX2JpYXM9MCBkaXJlY3Q9MSB3ZWlnaHRiPTEgb3Blbl9nb3A9MCB3ZWlnaHRwPTIga2V5aW50PTI1MCBrZXlpbnRfbWluPTEgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD00MCByYz1jcmYgbWJ0cmVlPTEgY3JmPTI4LjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IGlwX3JhdGlvPTEuNDAgYXE9MToxLjAwAIAAAAAwZYiEAD//8m+P5OXfBeLGOfKE3xkODvFZuBflHv/+VwJIta6cbpIo4ABLoKBaYTkTAAAC7m1vb3YAAABsbXZoZAAAAAAAAAAAAAAAAAAAA+gAAAPoAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIYdHJhawAAAFx0a2hkAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAPoAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAACgAAAAWgAAAAAAJGVkdHMAAAAcZWxzdAAAAAAAAAABAAAD6AAAAAAAAQAAAAABkG1kaWEAAAAgbWRoZAAAAAAAAAAAAAAAAAAAQAAAAEAAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAATttaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAD7c3RibAAAAJdzdHNkAAAAAAAAAAEAAACHYXZjMQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAACgAFoASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAADFhdmNDAWQACv/hABhnZAAKrNlCjfkhAAADAAEAAAMAAg8SJZYBAAZo6+JLIsAAAAAYc3R0cwAAAAAAAAABAAAAAQAAQAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAAC5QAAAAEAAAAUc3RjbwAAAAAAAAABAAAAMAAAAGJ1ZHRhAAAAWm1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAALWlsc3QAAAAlqXRvbwAAAB1kYXRhAAAAAQAAAABMYXZmNTguMTIuMTAw';\n  source.type = 'video/mp4';\n  videoElement.srcObject = null;\n  videoElement.appendChild(source);\n  videoElement.play();\n\n  if (videoElement.readyState < 2) {\n    await new Promise(resolve => {\n      videoElement.addEventListener('loadeddata', () => resolve());\n    });\n  }\n}\n\n// Register backends.\nregisterTestEnv({name: 'cpu', backendName: 'cpu'});\nregisterTestEnv({\n  name: 'webgl2',\n  backendName: 'webgl',\n  flags: {\n    'WEBGL_VERSION': 2,\n    'WEBGL_CPU_FORWARD': false,\n    'WEBGL_SIZE_UPLOAD_UNIFORM': 0\n  }\n});\n\nexport function describeAllEnvs(testName: string, tests: () => void) {\n  describeWithFlags(testName, ALL_ENVS, () => {\n    tests();\n  });\n}\n\nexport function describeBrowserEnvs(testName: string, tests: () => void) {\n  describeWithFlags(testName, BROWSER_ENVS, () => {\n    tests();\n  });\n}\n\nexport function describeNodeEnvs(testName: string, tests: () => void) {\n  describeWithFlags(testName, NODE_ENVS, () => {\n    tests();\n  });\n}\n\n/**\n * Testing Utilities for browser audeo stream.\n */\nexport function setupFakeAudeoStream() {\n  navigator.mediaDevices.getUserMedia = async () => {\n    const stream = new MediaStream();\n    return stream;\n  };\n  // tslint:disable-next-line:no-any\n  (window as any).AudioContext = FakeAudioContext.createInstance;\n}\n\nexport class FakeAudioContext {\n  readonly sampleRate = 44100;\n\n  static createInstance() {\n    return new FakeAudioContext();\n  }\n\n  createMediaStreamSource() {\n    return new FakeMediaStreamAudioSourceNode();\n  }\n\n  createAnalyser() {\n    return new FakeAnalyser();\n  }\n\n  close(): void {}\n}\n\nexport class FakeAudioMediaStream {\n  constructor() {}\n  getTracks(): Array<{}> {\n    return [];\n  }\n}\n\nclass FakeMediaStreamAudioSourceNode {\n  constructor() {}\n  connect(node: {}): void {}\n}\n\nclass FakeAnalyser {\n  fftSize: number;\n  smoothingTimeConstant: number;\n  private x: number;\n  constructor() {\n    this.x = 0;\n  }\n\n  getFloatFrequencyData(data: Float32Array): void {\n    const xs: number[] = [];\n    for (let i = 0; i < this.fftSize / 2; ++i) {\n      xs.push(this.x++);\n    }\n    data.set(new Float32Array(xs));\n  }\n\n  getFloatTimeDomainData(data: Float32Array): void {\n    const xs: number[] = [];\n    for (let i = 0; i < this.fftSize / 2; ++i) {\n      xs.push(-(this.x++));\n    }\n    data.set(new Float32Array(xs));\n  }\n\n  disconnect(): void {}\n}\n"]}