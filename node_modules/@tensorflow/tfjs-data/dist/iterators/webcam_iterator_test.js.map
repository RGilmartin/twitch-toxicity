{"version":3,"file":"webcam_iterator_test.js","sourceRoot":"","sources":["../../src/iterators/webcam_iterator_test.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n *\n * =============================================================================\n */\n\nimport {memory, tensor3d, test_util} from '@tensorflow/tfjs-core';\nimport {describeBrowserEnvs, replaceHTMLVideoElementSource, setupFakeVideoStream} from '../util/test_utils';\nimport {WebcamIterator} from './webcam_iterator';\n\ndescribeBrowserEnvs('WebcamIterator', () => {\n  beforeEach(() => {\n    setupFakeVideoStream();\n  });\n\n  it('create webcamIterator with html element', async () => {\n    const videoElement = document.createElement('video');\n    videoElement.width = 160;\n    videoElement.height = 90;\n\n    const webcamIterator = await WebcamIterator.create(videoElement);\n\n    await replaceHTMLVideoElementSource(videoElement);\n\n    const result = await webcamIterator.next();\n    expect(result.done).toBeFalsy();\n    expect(result.value.shape).toEqual([90, 160, 3]);\n  });\n\n  it('create webcamIterator with html element and capture', async () => {\n    const videoElement = document.createElement('video');\n    videoElement.width = 160;\n    videoElement.height = 90;\n\n    const webcamIterator = await WebcamIterator.create(videoElement);\n\n    await replaceHTMLVideoElementSource(videoElement);\n\n    const result = await webcamIterator.capture();\n    expect(result.shape).toEqual([90, 160, 3]);\n  });\n\n  it('create webcamIterator with no html element', async () => {\n    const webcamIterator = await WebcamIterator.create(\n        null, {resizeWidth: 300, resizeHeight: 150});\n    const result = await webcamIterator.next();\n    expect(result.done).toBeFalsy();\n    expect(result.value.shape).toEqual([150, 300, 3]);\n  });\n\n  it('create webcamIterator with no html element and capture', async () => {\n    const webcamIterator = await WebcamIterator.create(\n        null, {resizeWidth: 300, resizeHeight: 150});\n    const result = await webcamIterator.capture();\n    expect(result.shape).toEqual([150, 300, 3]);\n  });\n\n  it('create webcamIterator with no html element and no size', async done => {\n    try {\n      await WebcamIterator.create();\n      done.fail();\n    } catch (e) {\n      expect(e.message).toEqual(\n          'Please provide webcam video element, or resizeWidth and ' +\n          'resizeHeight to create a hidden video element.');\n      done();\n    }\n  });\n\n  it('resize and center crop has correct shape with html element', async () => {\n    const videoElement = document.createElement('video');\n    videoElement.width = 100;\n    videoElement.height = 200;\n    const webcamIterator = await WebcamIterator.create(\n        videoElement, {resizeWidth: 30, resizeHeight: 40, centerCrop: true});\n    const result = await webcamIterator.next();\n    expect(result.done).toBeFalsy();\n    expect(result.value.shape).toEqual([40, 30, 3]);\n  });\n\n  it('resize and center crop has correct pixel with html element', async () => {\n    const videoElement = document.createElement('video');\n    videoElement.width = 4;\n    videoElement.height = 4;\n    const webcamIterator = await WebcamIterator.create(\n        videoElement, {resizeWidth: 2, resizeHeight: 2, centerCrop: true});\n    const originalImg = tensor3d([\n      [[1, 1, 1], [1, 1, 1], [1, 1, 1], [1, 1, 1]],\n      [\n        [1, 1, 1],\n        [11, 12, 13],\n        [14, 15, 16],\n        [1, 1, 1],\n      ],\n      [\n        [1, 1, 1],\n        [1, 2, 3],\n        [4, 5, 6],\n        [1, 1, 1],\n      ],\n      [[1, 1, 1], [1, 1, 1], [1, 1, 1], [1, 1, 1]]\n    ]);\n    const croppedImg = webcamIterator.cropAndResizeFrame(originalImg);\n    test_util.expectArraysClose(\n        await croppedImg.array(),\n        await tensor3d([\n          [[6.625, 7.1875, 7.75], [8.3125, 8.875, 9.4375]],\n\n          [[1, 1.5625, 2.125], [2.6875, 3.25, 3.8125]]\n        ]).array());\n  });\n\n  it('resize in bilinear method has correct shape with html element',\n     async () => {\n       const videoElement = document.createElement('video');\n       videoElement.width = 100;\n       videoElement.height = 200;\n\n       const webcamIterator = await WebcamIterator.create(\n           videoElement,\n           {resizeWidth: 30, resizeHeight: 40, centerCrop: false});\n       const result = await webcamIterator.next();\n       expect(result.done).toBeFalsy();\n       expect(result.value.shape).toEqual([40, 30, 3]);\n     });\n\n  it('resize in bilinear method has correct pixel with html element',\n     async () => {\n       const videoElement = document.createElement('video');\n       videoElement.width = 4;\n       videoElement.height = 4;\n       const webcamIterator = await WebcamIterator.create(\n           videoElement, {resizeWidth: 2, resizeHeight: 2, centerCrop: false});\n       const originalImg = tensor3d([\n         [[1, 1, 1], [1, 1, 1], [1, 1, 1], [1, 1, 1]],\n         [\n           [1, 1, 1],\n           [11, 12, 13],\n           [14, 15, 16],\n           [1, 1, 1],\n         ],\n         [\n           [1, 1, 1],\n           [1, 2, 3],\n           [4, 5, 6],\n           [1, 1, 1],\n         ],\n         [[1, 1, 1], [1, 1, 1], [1, 1, 1], [1, 1, 1]]\n       ]);\n       const croppedImg = webcamIterator.cropAndResizeFrame(originalImg);\n       test_util.expectArraysClose(\n           await croppedImg.array(), await tensor3d([\n                                       [[1, 1, 1], [1, 1, 1]],\n\n                                       [[1, 1, 1], [1, 1, 1]]\n                                     ]).array());\n     });\n\n  it('webcamIterator could stop', async () => {\n    const videoElement = document.createElement('video');\n    videoElement.width = 160;\n    videoElement.height = 90;\n\n    const webcamIterator = await WebcamIterator.create(videoElement);\n    await replaceHTMLVideoElementSource(videoElement);\n    const result1 = await webcamIterator.next();\n    expect(result1.done).toBeFalsy();\n    expect(result1.value.shape).toEqual([90, 160, 3]);\n\n    await webcamIterator.stop();\n    const result2 = await webcamIterator.next();\n    expect(result2.done).toBeTruthy();\n    expect(result2.value).toBeNull();\n  });\n\n  it('webcamIterator could restart', async () => {\n    const videoElement = document.createElement('video');\n    videoElement.width = 160;\n    videoElement.height = 90;\n\n    const webcamIterator = await WebcamIterator.create(videoElement);\n    await replaceHTMLVideoElementSource(videoElement);\n    const result1 = await webcamIterator.next();\n    expect(result1.done).toBeFalsy();\n    expect(result1.value.shape).toEqual([90, 160, 3]);\n\n    webcamIterator.stop();\n    const result2 = await webcamIterator.next();\n    expect(result2.done).toBeTruthy();\n    expect(result2.value).toBeNull();\n\n    // Skip validation when it's in Firefox and Mac OS, because BrowserStack for\n    // Firefox does not trigger the readyState event when restarting.\n    if (navigator.userAgent.search('Firefox') < 0 &&\n        navigator.userAgent.search('OS X') < 0) {\n          await webcamIterator.start();\n      await replaceHTMLVideoElementSource(videoElement);\n      const result3 = await webcamIterator.next();\n      expect(result3.done).toBeFalsy();\n      expect(result3.value.shape).toEqual([90, 160, 3]);\n    }\n  });\n\n  it('capture with cropAndResize has no memory leaks', async () => {\n    const videoElement = document.createElement('video');\n    videoElement.width = 100;\n    videoElement.height = 200;\n    const webcamIterator = await WebcamIterator.create(\n        videoElement, { resizeWidth: 30, resizeHeight: 40, centerCrop: true });\n\n    const before = memory();\n\n    const result = await webcamIterator.capture();\n    result.dispose();\n\n    const after = memory();\n\n    expect(after.numTensors).toEqual(before.numTensors);\n  });\n});\n"]}